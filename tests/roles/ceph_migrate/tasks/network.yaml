- name: Setup a tmp client ip address on the src node
  become: true
  block:
    - name: Get current mon IP address
      ansible.builtin.set_fact:
        mon_ipaddr: "{{ mon_ip | split(':') | first | ansible.utils.ipaddr }}"
      vars:
        mon_ip: |-
          {% for mon in mon_dump.mons %}
          {%   if mon.name == cur_mon %}
          {{ mon.addr }}
          {%   endif %}
          {% endfor %}
    - name: Patch os-net-config config and setup a tmp client IP
      delegate_to: "{{ cur_mon }}.ctlplane"
      lineinfile:
        dest: "{{ os_net_conf_path }}"
        insertafter: '{{ mon_ipaddr }}/24'
        line: "    - ip_netmask: {{ ceph_client_ip }}/24"
        backup: yes

    - name: Refresh os-net-config
      ansible.builtin.shell:
        "os-net-config -c {{ os_net_conf_path }}"
